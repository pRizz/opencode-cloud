# opencode-cloud Docker Compose
#
# Quick start:
#   docker compose up -d
#
# This configures all persistent volumes automatically so your data
# survives container restarts, updates, and recreation.
#
# First-time setup:
#   docker compose logs | grep "INITIAL ONE-TIME PASSWORD"
#   Open http://localhost:3000 and enter the IOTP to complete setup.
#
# Docs: https://github.com/pRizz/opencode-cloud

services:
  opencode:
    image: ${OPENCODE_IMAGE:-prizz/opencode-cloud-sandbox:latest}
    pull_policy: ${OPENCODE_PULL_POLICY:-missing}
    container_name: opencode-cloud-sandbox
    restart: unless-stopped
    init: true
    stop_grace_period: ${OPENCODE_STOP_GRACE_PERIOD:-30s}
    ports:
      - "${OPENCODE_PORT_MAPPING:-127.0.0.1:3000:3000}"
    environment:
      OPENCODE_HOST: ${OPENCODE_HOST:-0.0.0.0}
    logging:
      driver: ${OPENCODE_LOG_DRIVER:-json-file}
      options:
        max-size: ${OPENCODE_LOG_MAX_SIZE:-10m}
        max-file: "${OPENCODE_LOG_MAX_FILE:-3}"
    volumes:
      - opencode-data:/home/opencoder/.local/share/opencode
      - opencode-state:/home/opencoder/.local/state/opencode
      - opencode-cache:/home/opencoder/.cache/opencode
      - opencode-workspace:/home/opencoder/workspace
      - opencode-config:/home/opencoder/.config/opencode
      - opencode-users:/var/lib/opencode-users

volumes:
  opencode-data:
  opencode-state:
  opencode-cache:
  opencode-workspace:
  opencode-config:
  opencode-users:
