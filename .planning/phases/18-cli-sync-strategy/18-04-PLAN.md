---
phase: 18-cli-sync-strategy
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli-darwin-arm64/package.json
  - packages/cli-darwin-x64/package.json
  - packages/cli-linux-arm64/package.json
  - packages/cli-linux-x64/package.json
  - packages/cli-linux-x64-musl/package.json
  - packages/cli-linux-arm64-musl/package.json
autonomous: true

must_haves:
  truths:
    - "Platform packages have os and cpu fields for npm auto-selection"
    - "Platform packages contain only binary placeholder and package.json"
    - "Platform package names follow @opencode-cloud/cli-{platform}-{arch} pattern"
  artifacts:
    - path: "packages/cli-darwin-arm64/package.json"
      provides: "macOS ARM64 platform package manifest"
      contains: '"os": ["darwin"]'
    - path: "packages/cli-linux-x64/package.json"
      provides: "Linux x64 platform package manifest"
      contains: '"os": ["linux"]'
  key_links:
    - from: "packages/cli-*/package.json"
      to: "npm registry"
      via: "os and cpu fields"
      pattern: '"os":|"cpu":'
---

<objective>
Create platform-specific npm package scaffolds for prebuilt binary distribution.

Purpose: Following the esbuild/swc pattern, each platform gets its own npm package with os/cpu fields. When users `npm install opencode-cloud`, npm automatically downloads only the package matching their platform.

Output: Six platform package directories with package.json files ready for binary insertion and npm publish.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-cli-sync-strategy/18-CONTEXT.md
@.planning/phases/18-cli-sync-strategy/18-RESEARCH.md
@packages/cli-node/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Darwin platform packages</name>
  <files>packages/cli-darwin-arm64/package.json, packages/cli-darwin-x64/package.json</files>
  <action>
Create two macOS platform package directories:

1. Create `packages/cli-darwin-arm64/package.json`:
```json
{
  "name": "@opencode-cloud/cli-darwin-arm64",
  "version": "3.0.0",
  "description": "opencode-cloud CLI binary for macOS ARM64 (Apple Silicon)",
  "license": "MIT",
  "author": "pRizz",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/pRizz/opencode-cloud.git",
    "directory": "packages/cli-darwin-arm64"
  },
  "homepage": "https://github.com/pRizz/opencode-cloud",
  "os": ["darwin"],
  "cpu": ["arm64"],
  "files": ["bin"],
  "main": "index.js"
}
```

2. Create `packages/cli-darwin-arm64/index.js`:
```javascript
const path = require('path');
module.exports.binaryPath = path.join(__dirname, 'bin', 'occ');
```

3. Create `packages/cli-darwin-arm64/bin/.gitkeep` (placeholder for binary)

4. Repeat for `packages/cli-darwin-x64/` with:
   - name: "@opencode-cloud/cli-darwin-x64"
   - description: "...for macOS x64 (Intel)"
   - cpu: ["x64"]
  </action>
  <verify>
`ls packages/cli-darwin-arm64/` and `ls packages/cli-darwin-x64/` show package.json, index.js, bin/.gitkeep
  </verify>
  <done>
Darwin platform packages created with os: darwin and appropriate cpu fields.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Linux glibc platform packages</name>
  <files>packages/cli-linux-arm64/package.json, packages/cli-linux-x64/package.json</files>
  <action>
Create two Linux (glibc) platform package directories:

1. Create `packages/cli-linux-x64/package.json`:
```json
{
  "name": "@opencode-cloud/cli-linux-x64",
  "version": "3.0.0",
  "description": "opencode-cloud CLI binary for Linux x64 (glibc)",
  "license": "MIT",
  "author": "pRizz",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/pRizz/opencode-cloud.git",
    "directory": "packages/cli-linux-x64"
  },
  "homepage": "https://github.com/pRizz/opencode-cloud",
  "os": ["linux"],
  "cpu": ["x64"],
  "libc": ["glibc"],
  "files": ["bin"],
  "main": "index.js"
}
```

2. Create `packages/cli-linux-x64/index.js`:
```javascript
const path = require('path');
module.exports.binaryPath = path.join(__dirname, 'bin', 'occ');
```

3. Create `packages/cli-linux-x64/bin/.gitkeep`

4. Repeat for `packages/cli-linux-arm64/` with:
   - name: "@opencode-cloud/cli-linux-arm64"
   - description: "...for Linux ARM64 (glibc)"
   - cpu: ["arm64"]

Note: The `libc` field is supported by npm and helps distinguish glibc from musl builds.
  </action>
  <verify>
`ls packages/cli-linux-x64/` and `ls packages/cli-linux-arm64/` show package.json, index.js, bin/.gitkeep
  </verify>
  <done>
Linux glibc platform packages created with os: linux, libc: glibc, and appropriate cpu fields.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Linux musl platform packages</name>
  <files>packages/cli-linux-x64-musl/package.json, packages/cli-linux-arm64-musl/package.json</files>
  <action>
Create two Linux (musl/Alpine) platform package directories:

1. Create `packages/cli-linux-x64-musl/package.json`:
```json
{
  "name": "@opencode-cloud/cli-linux-x64-musl",
  "version": "3.0.0",
  "description": "opencode-cloud CLI binary for Linux x64 (musl/Alpine)",
  "license": "MIT",
  "author": "pRizz",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/pRizz/opencode-cloud.git",
    "directory": "packages/cli-linux-x64-musl"
  },
  "homepage": "https://github.com/pRizz/opencode-cloud",
  "os": ["linux"],
  "cpu": ["x64"],
  "libc": ["musl"],
  "files": ["bin"],
  "main": "index.js"
}
```

2. Create `packages/cli-linux-x64-musl/index.js`:
```javascript
const path = require('path');
module.exports.binaryPath = path.join(__dirname, 'bin', 'occ');
```

3. Create `packages/cli-linux-x64-musl/bin/.gitkeep`

4. Repeat for `packages/cli-linux-arm64-musl/` with:
   - name: "@opencode-cloud/cli-linux-arm64-musl"
   - description: "...for Linux ARM64 (musl/Alpine)"
   - cpu: ["arm64"]
  </action>
  <verify>
`ls packages/cli-linux-x64-musl/` and `ls packages/cli-linux-arm64-musl/` show package.json, index.js, bin/.gitkeep
  </verify>
  <done>
Linux musl platform packages created with os: linux, libc: musl, and appropriate cpu fields.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. Six platform package directories exist under packages/
2. Each has package.json with correct name, os, cpu, and libc fields
3. Each has index.js exporting binaryPath
4. Each has bin/.gitkeep placeholder
5. All package versions are 3.0.0 (matching main package)
</verification>

<success_criteria>
- Six platform packages created: darwin-arm64, darwin-x64, linux-x64, linux-arm64, linux-x64-musl, linux-arm64-musl
- Each package.json has os and cpu fields for npm auto-selection
- Each package exports binaryPath for the main package to find the binary
- Directory structure ready for CI to place compiled binaries
</success_criteria>

<output>
After completion, create `.planning/phases/18-cli-sync-strategy/18-04-SUMMARY.md`
</output>
