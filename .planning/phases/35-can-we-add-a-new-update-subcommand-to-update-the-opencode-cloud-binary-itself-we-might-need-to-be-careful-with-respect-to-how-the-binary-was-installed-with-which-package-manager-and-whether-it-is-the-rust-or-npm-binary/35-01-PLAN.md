---
phase: 35-can-we-add-a-new-update-subcommand-to-update-the-opencode-cloud-binary-itself-we-might-need-to-be-careful-with-respect-to-how-the-binary-was-installed-with-which-package-manager-and-whether-it-is-the-rust-or-npm-binary
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli-rust/src/commands/update.rs
  - packages/cli-rust/src/lib.rs
  - packages/cli-rust/src/output/errors.rs
  - README.md
autonomous: true

must_haves:
  truths:
    - "Update CLI can re-install opencode-cloud when the install method is known"
    - "Users get a clear error when install method cannot be detected"
    - "Service restarts after a successful opencode-cloud update"
  artifacts:
    - path: "packages/cli-rust/src/commands/update.rs"
      provides: "Update subcommand flow for opencode-cloud binary"
      contains: "update cli"
    - path: "README.md"
      provides: "User-facing instructions for updating the CLI"
      contains: "update"
---

<objective>
Add a new update subcommand that can update the opencode-cloud binary itself, choosing the correct installation method (cargo or npm) when possible and restarting the service afterward.

Purpose: Make self-updating safe and predictable without requiring users to re-install manually.
Output: A dedicated CLI update subcommand with clear detection and fallback messaging.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@README.md
@packages/cli-rust/src/commands/update.rs
@packages/cli-rust/src/commands/restart.rs
@packages/cli-rust/src/lib.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define update command UX and detection logic</name>
  <files>packages/cli-rust/src/commands/update.rs</files>
  <action>
Decide the subcommand shape (e.g., `occ update cli` or `occ update self`) and how to detect install method:
- Cargo install: look for cargo metadata or `cargo install opencode-cloud` guidance.
- npm install: detect Node wrapper/binary location and provide `npm install -g opencode-cloud` instructions.
Define fallback behavior when detection is unknown (print actionable guidance and exit).
  </action>
  <verify>
Write down exact CLI wording and detection rules so implementation is unambiguous.
  </verify>
  <done>
Detection rules and user messaging are fully specified.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement opencode-cloud update subcommand</name>
  <files>packages/cli-rust/src/commands/update.rs</files>
  <action>
Add a new update subcommand for the CLI binary and wire it into `occ update`:
- Detect install method and run the correct update command.
- Ensure the service is restarted after update (reuse restart command).
- Preserve existing update behavior for container/opencode subcommands.
  </action>
  <verify>
Run the CLI subcommand locally to ensure it prints the expected messaging and executes the correct update command.
  </verify>
  <done>
CLI update subcommand is implemented and restarts the service on success.
  </done>
</task>

<task type="auto">
  <name>Task 3: Document new update command</name>
  <files>README.md</files>
  <action>
Add a brief section to the README under Usage that explains the new update command, including what it updates and any constraints.
  </action>
  <verify>
README examples match the actual CLI subcommand name and behavior.
  </verify>
  <done>
Documentation includes the new update command with correct usage.
  </done>
</task>

</tasks>

<verification>
1. Update subcommand updates the CLI binary using correct install method
2. Service restarts after update success
3. Clear error/help guidance when install method is unknown
</verification>

<success_criteria>
- `occ update <cli-subcommand>` updates opencode-cloud itself
- Unsupported install methods yield actionable guidance
- Service restart follows a successful update
</success_criteria>

<output>
After completion, create `.planning/phases/35-can-we-add-a-new-update-subcommand-to-update-the-opencode-cloud-binary-itself-we-might-need-to-be-careful-with-respect-to-how-the-binary-was-installed-with-which-package-manager-and-whether-it-is-the-rust-or-npm-binary/35-01-SUMMARY.md`
</output>
